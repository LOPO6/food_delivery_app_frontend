<div class="restaurant-page">
  <a class="back-button" routerLink="/restaurant" href="/restaurant" role="button" tabindex="0">‚Üê Back to Browse</a>

  <div class="restaurant-header">
    

    <div class="restaurant-image-container" [class.editable]="canUploadImage">
      <img
        [src]="restaurant.imageUrl || '/GourmAI_Logo.png'"
        [alt]="restaurant.name"
        class="restaurant-image"
      />
      <div *ngIf="canUploadImage" class="image-edit-overlay" (click)="fileInput.click()">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="edit-icon">
          <path d="M21.731 2.269a2.625 2.625 0 00-3.712 0l-1.157 1.157 3.712 3.712 1.157-1.157a2.625 2.625 0 000-3.712zM19.513 8.199l-3.712-3.712-8.4 8.4a5.25 5.25 0 00-1.32 2.214l-.8 2.685a.75.75 0 00.933.933l2.685-.8a5.25 5.25 0 002.214-1.32l8.4-8.4z" />
          <path d="M5.25 5.25a3 3 0 00-3 3v10.5a3 3 0 003 3h10.5a3 3 0 003-3V13.5a.75.75 0 00-1.5 0v5.25a1.5 1.5 0 01-1.5 1.5H5.25a1.5 1.5 0 01-1.5-1.5V8.25a1.5 1.5 0 011.5-1.5h5.25a.75.75 0 000-1.5H5.25z" />
        </svg>
      </div>
      <input 
        #fileInput
        type="file" 
        accept="image/*" 
        (change)="onFileSelected($event)" 
        style="display: none;"
      />
    </div>
    
    <div class="restaurant-info">
      <div class="restaurant-details">
      <h3>Restaurant Info</h3>
      <p><strong>Phone Number:</strong> {{ restaurant.phone }}</p>
      <p><strong>Address:</strong> {{ restaurant.address }}</p>
      <p><strong>Cuisine Type:</strong> {{ restaurant.cuisineType}}</p>
      </div>
      <h3 id="rate-us" *ngIf="hasOrdered">Rate us</h3>
      <div class="star-rating">
      <!-- Output five stars, add the font awesome class (fa) to each-->
       <!--  Add the ngClass based on -->
        <ng-container *ngFor="let star of stars; let i = index;">
          <i *ngIf="hasOrdered && !hasRatedPrev" class="fa-star"
            [ngClass]="{
              'fa-solid': i+1 <= (hovered || rating),

              'fa-regular': i+1 > (hovered || rating)
            }"
            (mouseenter)="hovered = i+1"
            (mouseleave)="hovered = 0"
            (click)="setRating(i+1)">
          </i>

          <i *ngIf="hasOrdered && hasRatedPrev" class="fa-star"
            [ngClass]="{
              'fa-solid': i+1 <= (rating),

              'fa-regular': i+1 > (rating)
            }"
            (click)="tellUserTheyHaveAlreadyReviewedFunction()">
          </i>


        </ng-container>
      </div>
        <p *ngIf="rating != 0" id="rating-message">Thanks for rating us!</p>
        <p *ngIf="tellUserTheyHaveAlreadyReviewed"> You have already reviewed! </p>
    </div>

    <div class="restaurant-heading"> <!--display of name and description we need to add in-->
      <h1>{{ restaurant.name }}</h1>
      <p>{{restaurant.details}}</p>
    </div>
  </div>

  <div class="menu-section">
  <div class="toast-notification" *ngIf="showToast">
    <p>Item added to cart</p>
  </div>
    <h2>Menu</h2>

    <div class="menu-categories">
      <button 
        *ngFor="let category of categories"
        [class.active]="selectedCategory === category"
        (click)="filterByCategory(category)">
        {{ category }}
      </button>
    </div>

    <!-- Add/Edit Menu Item Form (Admin/Owner Only) -->
    <div *ngIf="canUploadImage" class="menu-management">
      <button class="btn-add-item" (click)="toggleAddForm()">
        {{ showAddForm ? 'Cancel' : '+ Add Menu Item' }}
      </button>

      <div *ngIf="showAddForm" class="add-item-form">
        <h3>{{ editingItem ? 'Edit Menu Item' : 'Add New Menu Item' }}</h3>
        <div class="form-group">
          <label>Item Name</label>
          <input type="text" [(ngModel)]="newItem.item_name" placeholder="e.g., Cheeseburger" />
        </div>
        <div class="form-group">
          <label>Price ($)</label>
          <input type="number" [(ngModel)]="newItem.item_price" step="0.01" min="0" placeholder="9.99" />
        </div>
        <div class="form-group">
          <label>Category</label>
          <select [(ngModel)]="newItem.category">
            <option *ngFor="let cat of categories" [value]="cat" [disabled]="cat === 'All Items'">{{ cat }}</option>
          </select>
          <small style="display: block; margin-top: 0.25rem; color: #666;">Or type a new category name to create it</small>
          <input type="text" [(ngModel)]="newItem.category" placeholder="e.g., Appetizers, Desserts, Beverages" style="margin-top: 0.5rem;" />
        </div>
        <div class="form-group">
          <label>Description (Optional)</label>
          <textarea [(ngModel)]="newItem.description" rows="3" placeholder="Brief description of the item..."></textarea>
        </div>
        <div class="form-actions">
          <button class="btn-save" (click)="saveMenuItem()">{{ editingItem ? 'Update' : 'Add' }}</button>
          <button class="btn-cancel" (click)="toggleAddForm()">Cancel</button>
        </div>
      </div>
    </div>

    <div class="menu-grid">
      <div class="menu-card" *ngFor="let item of filteredMenuItems">
        <div class="menu-details">
          <h3>{{ item.item_name }}</h3>
          <p class="item-category" *ngIf="item.category && item.category !== 'All Items'">{{ item.category }}</p>
          <p class="item-description" *ngIf="item.description">{{ item.description }}</p>
          <p class="item-price">${{ item.item_price?.toFixed(2) }}</p>
        </div>
        <div class="menu-actions">
          <button class="add-btn" (click)="addToCart(item)" [attr.aria-label]="'Add ' + item.item_name + ' to cart'">+</button>
          <div *ngIf="canUploadImage" class="admin-actions">
            <button class="btn-edit" (click)="startEdit(item)" title="Edit item">‚úé</button>
            <button class="btn-delete" (click)="deleteMenuItem(item)" title="Delete item">üóë</button>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="toast" *ngIf="showToast">
    <p>Item added to cart</p>
  </div>
  <!-- End of html div -->




